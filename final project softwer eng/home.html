<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Digital Library</title>
  <link rel="stylesheet" href="home.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
</head>
<body>
  <div class="container">
    <!-- Sidebar for search and navigation -->
    <aside class="sidebar">
      <h1 class="logo"><img src="logo2.png" alt="Logo" style="height: 40px;"/></h1>
      <ul class="nav">
        <li><a href="#booksGridSection" class="active"><i class="fas fa-home"></i> Home</a></li>
        <li><a href="#fictionSection"><i class="fas fa-book-open"></i> Fiction</a></li>
        <li><a href="#nonFictionSection"><i class="fas fa-lightbulb"></i> Non‑Fiction</a></li>
        <li><a href="#bestSellersSection"><i class="fas fa-star"></i> Favorite books</a></li>
        <li><a href="#newArrivalsSection"><i class="fas fa-gift"></i> Free Books</a></li>
        <li><a href="#historySection"><i class="fas fa-history"></i> History</a></li>
        <li><a href="#scifiSection"><i class="fas fa-robot"></i> Sci-Fi</a></li>
        <li><a href="#literatureSection"><i class="fas fa-feather"></i> Literature</a></li>
      </ul>
    </aside>
    <!-- Sidebar toggle button, always accessible -->
    <button id="toggleSidebar" class="toggle-sidebar" aria-label="Toggle Sidebar">
      <i class="fas fa-bars"></i>
    </button>

    <!-- Main content area -->
    <main class="main-content">
      <!-- Top bar with search field and user info -->
      <header class="topbar">
        <button id="loginButton" onclick="window.location.href='login.html'" class="login-button" title="Login">
          <i class="fas fa-user"></i>
        </button>
        <button id="cartButton" class="cart-button" title="Cart">
          <i class="fas fa-shopping-cart"></i>
        </button>
        <span id="cartBadge" class="cart-badge" style="display:none;">0</span>
        <div class="search-bar-container">
          <h1 class="welcome-text">Welcome to Digital Library 📚</h1>
          <div class="search-bar">
            <input type="text" id="searchInput" placeholder="Search by title or author…" />
            <button id="searchButton" type="button" class="search-button">
              Search
            </button>
          </div>
        </div>
        <div class="user-info">
          <span class="user-name"></span>
        </div>
        <button id="darkModeToggle" class="dark-mode-toggle">
          🌙
        </button>
      </header>

      <!-- Section to display search results -->
      <section class="books-section" id="searchResultsSection" style="display:none;">
        <h2>Search Results & Price Comparison</h2>
        <div class="books-grid" id="searchResultsGrid" style="justify-items:center;"></div>
        <div id="comparisonNote" style="margin-top:12px; font-size:0.95em; color:#888;">
          Prices are fetched from <b>Google Books</b>, <b>Amazon</b>, and <b>eBay</b>. The lowest price is highlighted for your convenience.<br>
          <b>Click a "Buy" link</b> in the table to select your preferred website and purchase the book.
        </div>
      </section>

      <!-- Most Popular Books display area -->
      <section class="books-section" id="booksGridSection">
        <h2>Most popular</h2>
        <div class="books-grid" id="booksGrid">
          <!-- Most popular books from API will be inserted here -->
        </div>
      </section>

      <!-- New category sections -->
      <section class="category-section" id="fictionSection">
        <h2>Fiction</h2>
        <div class="books-grid" id="fictionGrid">
          <!-- Fiction books will be inserted here -->
        </div>
      </section>

      <section class="category-section" id="nonFictionSection">
        <h2>Non-Fiction</h2>
        <div class="books-grid" id="nonFictionGrid">
          <!-- Non-Fiction books will be inserted here -->
        </div>
      </section>

      <section class="category-section" id="bestSellersSection">
        <h2>Favorite books</h2>
        <div class="books-grid" id="bestSellersGrid">
          <!-- Best Sellers books will be inserted here -->
        </div>
      </section>

      <section class="category-section" id="newArrivalsSection">
        <h2>Free Books</h2>
        <div class="books-grid" id="newArrivalsGrid">
          <!-- New Arrivals books will be inserted here -->
        </div>
      </section>

      <section class="category-section" id="historySection">
        <h2>History</h2>
        <div class="books-grid" id="historyGrid"></div>
      </section>
      <section class="category-section" id="scifiSection">
        <h2>Sci-Fi</h2>
        <div class="books-grid" id="scifiGrid"></div>
      </section>
      <section class="category-section" id="literatureSection">
        <h2>Literature</h2>
        <div class="books-grid" id="literatureGrid"></div>
      </section>
    </main>
  </div>
  <footer class="site-footer">
    <p>&copy; 2025 Digital Library — All rights reserved.</p>
    <div class="footer-links">
      <a href="mianpage.html#about"><i class="fas fa-info-circle"></i> About</a>
      <a href="#"><i class="fas fa-envelope"></i> Contact</a>
      <a href="#"><i class="fas fa-lock"></i> Privacy</a>
    </div>
  </footer>
  <!-- Cart Modal -->
  <div id="cartModal" class="modal">
    <div class="modal-content">
      <span class="close-btn" id="closeCartModal">&times;</span>
      <h2>Your Cart</h2>
      <ul id="cartItemsList" class="cart-items-list"></ul>
      <button id="checkoutButton" class="checkout-button">Checkout</button>
    </div>
  </div>
  <script>
    // Sidebar toggle functionality
    const toggleSidebarBtn = document.getElementById('toggleSidebar');
    const sidebar = document.querySelector('.sidebar');
    const container = document.querySelector('.container');
    function toggleSidebar() {
      sidebar.classList.toggle('hidden');
      // Add/remove a class on container to allow main-content to stretch
      if (sidebar.classList.contains('hidden')) {
        container.classList.add('sidebar-hidden');
      } else {
        container.classList.remove('sidebar-hidden');
      }
    }
    toggleSidebarBtn.addEventListener('click', toggleSidebar);
    // Optionally, hide sidebar on small screens by default
    function handleSidebarOnResize() {
      if (window.innerWidth <= 900) {
        sidebar.classList.add('hidden');
        container.classList.add('sidebar-hidden');
      } else {
        sidebar.classList.remove('hidden');
        container.classList.remove('sidebar-hidden');
      }
    }
    window.addEventListener('resize', handleSidebarOnResize);
    // Initial check
    handleSidebarOnResize();
    const booksGrid = document.getElementById('booksGrid');
    const fictionGrid = document.getElementById('fictionGrid');
    const nonFictionGrid = document.getElementById('nonFictionGrid');
    const bestSellersGrid = document.getElementById('bestSellersGrid');
    const newArrivalsGrid = document.getElementById('newArrivalsGrid');
    const historyGrid = document.getElementById('historyGrid');
    const scifiGrid = document.getElementById('scifiGrid');
    const literatureGrid = document.getElementById('literatureGrid');

    const searchInput = document.getElementById('searchInput');
    const searchButton = document.getElementById('searchButton');
    const searchResultsSection = document.getElementById('searchResultsSection');
    const searchResultsGrid = document.getElementById('searchResultsGrid');

    // Function to create a book card
    function createBookCard(book) {
      const bookCard = document.createElement('div');
      bookCard.className = 'book-card';

      // Wrap book card content in a link to book-details.html with book ID
      const bookLink = document.createElement('a');
      bookLink.href = `book-details.html?id=${encodeURIComponent(book.id)}`;
      bookLink.style.textDecoration = 'none';
      bookLink.style.color = 'inherit';

      const bookCover = document.createElement('div');
      bookCover.className = 'book-cover';
      if (book.volumeInfo.imageLinks) {
        const img = document.createElement('img');
        // Use higher resolution image if available
        if (book.volumeInfo.imageLinks.extraLarge) {
          img.src = book.volumeInfo.imageLinks.extraLarge;
        } else if (book.volumeInfo.imageLinks.large) {
          img.src = book.volumeInfo.imageLinks.large;
        } else if (book.volumeInfo.imageLinks.medium) {
          img.src = book.volumeInfo.imageLinks.medium;
        } else if (book.volumeInfo.imageLinks.thumbnail) {
          img.src = book.volumeInfo.imageLinks.thumbnail;
        } else {
          img.src = '';
        }
        img.alt = book.volumeInfo.title || 'Book Cover';
        img.style.width = '100%';
        img.style.height = 'auto';
        bookCover.appendChild(img);
      } else {
        bookCover.textContent = 'No Image';
        bookCover.style.display = 'flex';
        bookCover.style.alignItems = 'center';
        bookCover.style.justifyContent = 'center';
        bookCover.style.backgroundColor = '#ccc';
        bookCover.style.height = '150px';
        bookCover.style.color = '#666';
      }

      bookLink.appendChild(bookCover);
      bookCard.appendChild(bookLink);

      // Create book info outside the link, below the cover
      const bookInfo = document.createElement('div');
      bookInfo.className = 'book-info';

      const title = document.createElement('h3');
      title.textContent = book.volumeInfo.title || 'No Title';

      const authors = document.createElement('p');
      authors.textContent = book.volumeInfo.authors ? book.volumeInfo.authors.join(', ') : 'Unknown Author';

      bookInfo.appendChild(title);
      bookInfo.appendChild(authors);

      const addToCartBtn = document.createElement('button');
      addToCartBtn.textContent = 'Add to Cart 🛒';
      addToCartBtn.style.marginTop = '6px';
      addToCartBtn.style.padding = '6px 10px';
      addToCartBtn.style.border = 'none';
      addToCartBtn.style.borderRadius = '8px';
      addToCartBtn.style.backgroundColor = 'var(--primary-color)';
      addToCartBtn.style.color = '#fff';
      addToCartBtn.style.cursor = 'pointer';
      addToCartBtn.onclick = () => addToCart(book);

      bookInfo.appendChild(addToCartBtn);

      bookCard.appendChild(bookInfo);

      return bookCard;
    }

    // Function to fetch books based on the search query
    async function fetchBooks(query) {
      if (!query) {
        searchResultsSection.style.display = 'none';
        return;
      }

      const url = `https://www.googleapis.com/books/v1/volumes?q=${encodeURIComponent(query)}&maxResults=12`;

      try {
        const response = await fetch(url);
        const data = await response.json();
        searchResultsGrid.innerHTML = '';

        if (data.items && data.items.length > 0) {
          data.items.forEach(book => {
            searchResultsGrid.appendChild(createBookCard(book));
          });
          searchResultsSection.style.display = 'block';
        } else {
          searchResultsGrid.innerHTML = '<p>No books found.</p>';
          searchResultsSection.style.display = 'block';
        }
      } catch (error) {
        searchResultsGrid.innerHTML = '<p>Error loading books.</p>';
        searchResultsSection.style.display = 'block';
        console.error('Error fetching books:', error);
      }
    }

    // Event listener for search button
    searchButton.addEventListener('click', () => {
      const query = searchInput.value.trim();
      fetchBooks(query);
    });

    // Event listener for enter key to trigger search
    searchInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        const query = searchInput.value.trim();
        fetchBooks(query);
      }
    });

    async function fetchCategoryBooks(query = 'best seller', category = '') {
      let url = `https://www.googleapis.com/books/v1/volumes?q=${encodeURIComponent(query)}&printType=books&orderBy=relevance&maxResults=12`;

      // Adjust URL based on category
      switch(category) {
        case 'history':
          url = `https://www.googleapis.com/books/v1/volumes?q=subject:history&printType=books&orderBy=relevance&maxResults=12`;
          break;
        case 'scifi':
          url = `https://www.googleapis.com/books/v1/volumes?q=subject:science fiction&printType=books&orderBy=relevance&maxResults=12`;
          break;
        case 'literature':
          url = `https://www.googleapis.com/books/v1/volumes?q=subject:literature&printType=books&orderBy=relevance&maxResults=12`;
          break;
        default:
          url = `https://www.googleapis.com/books/v1/volumes?q=${encodeURIComponent(query)}&printType=books&orderBy=relevance&maxResults=12`;
          break;
      }

      const containerId = category ? `${category}Grid` : 'booksGrid';
      const container = document.getElementById(containerId);
      if (!container) return;

      container.innerHTML = 'Loading...';
      try {
        const response = await fetch(url);
        const data = await response.json();
        console.log(`Fetched books data for category "${category}":`, data);
        container.innerHTML = '';
        if (data.items && data.items.length > 0) {
          data.items.forEach(book => {
            container.appendChild(createBookCard(book));
          });
        } else {
          container.textContent = 'No books found.';
        }
      } catch (error) {
        container.textContent = 'Error loading books.';
        console.error('Error fetching books:', error);
      }
    }

    async function loadAllSections() {
      // Most Popular Books (using 'best seller')
      await fetchCategoryBooks('best seller');
      // Fiction
      await fetchCategoryBooks('fiction', 'fiction');
      // Non-Fiction
      await fetchCategoryBooks('non-fiction', 'nonFiction');
      // Best Sellers (using a popular keyword to simulate best sellers)
      await fetchCategoryBooks('best sellers', 'bestSellers');
      // New Arrivals (using a filter for recent years)
      const currentYear = new Date().getFullYear();
      await fetchCategoryBooks(`subject:fiction+publishedDate:${currentYear}`, 'newArrivals');
      // History
      await fetchCategoryBooks('history', 'history');
      // Sci-Fi
      await fetchCategoryBooks('science fiction', 'scifi');
      // Literature
      await fetchCategoryBooks('literature', 'literature');
    }

    // Dark mode toggle
    const darkModeToggle = document.getElementById('darkModeToggle');
    const currentMode = localStorage.getItem('theme');

    if (currentMode === 'dark') {
      document.body.classList.add('dark');
      darkModeToggle.textContent = '☀️';
    }

    darkModeToggle.addEventListener('click', () => {
      document.body.classList.toggle('dark');
      const isDark = document.body.classList.contains('dark');
      darkModeToggle.textContent = isDark ? '☀️' : '🌙';
      localStorage.setItem('theme', isDark ? 'dark' : 'light');
    });

    // Login button redirect
    const loginButton = document.getElementById('loginButton');
    loginButton.addEventListener('click', () => {
      window.location.href = 'login.html';
    });

    // Cart functionality
    const cartButton = document.getElementById('cartButton');
    const cartModal = document.getElementById('cartModal');
    const closeCartModal = document.getElementById('closeCartModal');
    const cartItemsList = document.getElementById('cartItemsList');
    let cart = [];

    cartButton.addEventListener('click', () => {
      renderCart();
      cartModal.style.display = 'block';
    });

    closeCartModal.addEventListener('click', () => {
      cartModal.style.display = 'none';
    });

    window.addEventListener('click', (event) => {
      if (event.target === cartModal) {
        cartModal.style.display = 'none';
      }
    });

    function addToCart(book) {
      cart.push(book);
      updateCartBadge();
      renderCart();
    }

    function removeFromCart(index) {
      cart.splice(index, 1);
      updateCartBadge();
      renderCart();
    }

    function updateCartBadge() {
      const cartBadge = document.getElementById('cartBadge');
      if (cart.length > 0) {
        cartBadge.style.display = 'flex';
        cartBadge.textContent = cart.length;
      } else {
        cartBadge.style.display = 'none';
      }
    }

    function renderCart() {
      cartItemsList.innerHTML = '';
      if (cart.length === 0) {
        cartItemsList.innerHTML = '<li>Your cart is empty.</li>';
        return;
      }
      cart.forEach((book, index) => {
        const li = document.createElement('li');
        li.textContent = book.volumeInfo.title || 'No Title';
        const removeBtn = document.createElement('button');
        removeBtn.textContent = 'Remove';
        removeBtn.onclick = () => removeFromCart(index);
        li.appendChild(removeBtn);
        cartItemsList.appendChild(li);
      });
    }

    const checkoutButton = document.getElementById('checkoutButton');
    checkoutButton.addEventListener('click', () => {
      if (cart.length === 0) {
        alert('Your cart is empty.');
        return;
      }
      alert('Proceeding to checkout with ' + cart.length + ' items.');
      // هنا يمكنك لاحقًا توجيه المستخدم إلى صفحة checkout حقيقية
    });

    // Initial load of all sections
    loadAllSections();
    
  </script>
</body>
</html>